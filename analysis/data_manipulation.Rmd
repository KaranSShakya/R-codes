---
title: "Data Manipulation"
site: workflowr::wflow_site
output:
  workflowr::wflow_html:
    toc: true
editor_options:
  chunk_output_type: console
---

[Home](index.html)

```{r eval=T, echo=F, warning=F, message=F}
library(tidyverse)
library(readxl)
library(readr)
library(rvest)
```

### Download Data - Online
To use data readily online. You need the **readr** package which reads csv files.
```{r eval=T, echo=T, warning=F, message=F}
url <- "https://raw.githubusercontent.com/rafalab/dslabs/master/inst/extdata/murders.csv"
dat <- read_csv(url)
```
To download the file we can use: (or an alternative is to simply write.excel or write.csv).
```{r eval=F, echo=T}
download.file(url, tmp_filename)
```
***

### Web Scrapping
If there isnt a csv/excel file to download, we can still access the data online and convert it into a dataframe. This is done from the **rvest** package, but is inbuilt in **tidyverse**. First, save the url page into an object in R *url*.
```{r eval=T, echo=T}
url <- "https://en.wikipedia.org/wiki/Murder_in_the_United_States_by_state"
h <- read_html(url)
```
If the HTML pages are divided into tables, you can extract it:
```{r eval=T, echo=T}
tab <- h %>% 
  html_nodes("table")
tab <- tab[[2]] #selecting the second node: which has the data.

tab <- tab %>% 
  html_table #finally a data with columns and rows
```
Set up coloumns names (makes sure it aligns with the data):
```{r eval=T, echo=T}
tab <- tab %>% 
  setNames(c("state", "population", "total", "murders", "gun_murders", "gun_ownership", "total_rate", "murder_rate", "gun_murder_rate"))
tab.data <- data.frame(tab) #data frame you can work with
```
***

### Numeric / Character ###
If x is character and y is numeric, and you want to reverse both these: 
```{r eval=F, echo=T}
y <- as.numeric(x)
x <- as.character(y)
```
***
### Wide / Long ###
This is mainly used to change WorldBank datasets. Example table: 
```{r eval=T, echo=F}
wide <- read_excel("data/data_test.xlsx", 
    sheet = "wide_long")
wide
```
**key** The columns to turn into rows. **value** what to call the data.
```{r eval=T, echo=T}
long <- wide %>% 
  gather(key="Year", value="Population", 2:4)
long
```
***
### Column Name ###
```{r eval=F, echo=T}
names(data)[1] <- "New_name"
```
***

